<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Box Geometry Model (BGM) files • rbgm</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Box Geometry Model (BGM) files">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rbgm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/BGM_Spatial.html">BGM as Spatial objects</a>
    </li>
    <li>
      <a href="../articles/BGM_examplefiles.html">BGM examples</a>
    </li>
    <li>
      <a href="../articles/BGMfiles.html">Box Geometry Model (BGM) files</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Box Geometry Model (BGM) files</h1>
                        <h4 class="author">Michael D. Sumner</h4>
            
            <h4 class="date">2020-04-12</h4>
      
      
      <div class="hidden name"><code>BGMfiles.Rmd</code></div>

    </div>

    
    
<div id="box-geometry-model-files" class="section level1">
<h1 class="hasAnchor">
<a href="#box-geometry-model-files" class="anchor"></a>Box Geometry Model files</h1>
<p>Box Geometry Model files are text files that store a spatially-explicit model domain used by the Atlantis Ecosystem Model.</p>
<p>The model domain consists of <strong>boxes</strong> (polygons) composed of <strong>faces</strong> (line segments) and an overall <strong>boundary</strong> that delimits the domain of the model.</p>
<p>The boundary will include boundary polygons that are not boxes in the model, but some box edges are on this boundary, for example some models bounded by land do not have boundary boxes on this edge.</p>
<p>The <strong>rbgm</strong> package includes tools to read the BGM format, returning tables of all X/Y vertices and tables of indices for the boxes and faces.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(rbgm)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dplyr)</span>
<span id="cb1-3"><a href="#cb1-3"></a>mfile &lt;-<span class="st"> </span>bgmfiles<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/bgmfiles/man/bgmfiles.html">bgmfiles</a></span>()[<span class="dv">1</span>]</span>
<span id="cb1-4"><a href="#cb1-4"></a></span>
<span id="cb1-5"><a href="#cb1-5"></a>bgm &lt;-<span class="st"> </span><span class="kw"><a href="../reference/bgmfile.html">bgmfile</a></span>(mfile)</span>
<span id="cb1-6"><a href="#cb1-6"></a></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(bgm)</span></code></pre></div>
<pre><code>## [1] "vertices"         "facesXverts"      "faces"            "facesXboxes"     
## [5] "boxesXverts"      "boxes"            "boundaryvertices" "extra"</code></pre>
</div>
<div id="box-and-face-attributes-and-model-topology" class="section level1">
<h1 class="hasAnchor">
<a href="#box-and-face-attributes-and-model-topology" class="anchor"></a>Box and face attributes, and model topology</h1>
<p>Both boxes and faces have attributes stored row-wise in the respective table.</p>
<p>These are the box attributes for this example</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(bgm<span class="op">$</span>boxes)</span></code></pre></div>
<pre><code>## # A tibble: 35 x 9
##    label nconn  botz        area vertmix horizmix  insideX  insideY  .bx0
##    &lt;chr&gt; &lt;int&gt; &lt;dbl&gt;       &lt;dbl&gt;   &lt;int&gt;    &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1 Box0      7 -53.7 9254788445.       1        1 3430169. 3073000.     0
##  2 Box1     81 -48.9 1996056923.       1        1 3498567. 3029308.     1
##  3 Box2    120 -55.7 3922348664.       1        1 3521055. 3050400.     2
##  4 Box3    105 -53.4 3576072582.       1        1 3523085. 3077300.     3
##  5 Box4     83 -30   1672921591.       1        1 3522699. 3102469.     4
##  6 Box5     12 -24.1  411048577.       1        1 3496968. 3124359.     5
##  7 Box6     16 -10.2  447377917.       1        1 3520947. 3133926.     6
##  8 Box7     18   0    402661184.       1        1 3523883. 3122610.     7
##  9 Box8     13 -15    705100219.       1        1 3562646. 3115917.     8
## 10 Box9      3  -5.4   93312196.       1        1 3581060. 3127380.     9
## # … with 25 more rows</code></pre>
<p>and these are the face attributes.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(bgm<span class="op">$</span>faces)</span></code></pre></div>
<pre><code>## # A tibble: 824 x 7
##    cosine  sine  left right length  .fx0 label
##     &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
##  1  0.112 0.994    34    32 29876.     0 face0
##  2  0.506 0.862    32    33 17891.     1 face1
##  3  0.116 0.993    34    33 10169.     2 face2
##  4  0.117 0.993    34    33   155.     3 face3
##  5  0.869 0.494    33    27  9391.     4 face4
##  6  0.118 0.993    34    27 12818.     5 face5
##  7  0.121 0.993    34    27 21316.     6 face6
##  8  0.276 0.961    32    33 25394.     7 face7
##  9  0.514 0.858    32    33  8425.     8 face8
## 10  0.136 0.991    32    30 14366.     9 face9
## # … with 814 more rows</code></pre>
<p>By using relations between these tables we can reconstruct the geometry appropriately. (This is pretty painful, but shows that we have all the information required.)</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>bgm<span class="op">$</span>boxes <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(label <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Box1"</span>, <span class="st">"Box11"</span>))  <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/join.html">inner_join</a></span>(bgm<span class="op">$</span>boxesXverts, <span class="st">".bx0"</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 x 10
##   label nconn  botz        area vertmix horizmix  insideX  insideY  .bx0  .vx0
##   &lt;chr&gt; &lt;int&gt; &lt;dbl&gt;       &lt;dbl&gt;   &lt;int&gt;    &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
## 1 Box1     81 -48.9 1996056923.       1        1 3498567. 3029308.     1   157
## 2 Box1     81 -48.9 1996056923.       1        1 3498567. 3029308.     1   178
## 3 Box1     81 -48.9 1996056923.       1        1 3498567. 3029308.     1   222
## 4 Box1     81 -48.9 1996056923.       1        1 3498567. 3029308.     1   219
## 5 Box1     81 -48.9 1996056923.       1        1 3498567. 3029308.     1   218
## 6 Box1     81 -48.9 1996056923.       1        1 3498567. 3029308.     1   217</code></pre>
</div>
<div id="convert-to-spatial-objects" class="section level1">
<h1 class="hasAnchor">
<a href="#convert-to-spatial-objects" class="anchor"></a>Convert to Spatial objects</h1>
<p>To avoid constructing boxes and faces manually, <code>rbgm</code> provides several helper functions to create the boxes, faces, coordinates, and boundary as <code>Spatial</code> objects from the <code>sp</code> package.</p>
<p>Since Spatial objects cannot store the full connectivity of the BGM structure, it is best to consider these as one-way conversions, keeping all the details in the raw tables as above.</p>
<p>To generate an object with just “Box1” and “Box11”, use the function <code>boxSpatial</code> and then subset on box labels.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>boxes &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="kw"><a href="../reference/rbgm-Spatial.html">boxSpatial</a></span>(bgm), label <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Box2"</span>, <span class="st">"Box16"</span>))</span></code></pre></div>
<p>To determine which faces belong to these boxes, first create all faces and then join.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>allfaces &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rbgm-Spatial.html">faceSpatial</a></span>(bgm)</span>
<span id="cb10-2"><a href="#cb10-2"></a>faces &lt;-<span class="st"> </span>allfaces[<span class="kw"><a href="https://rdrr.io/r/base/match.html">match</a></span>(bgm<span class="op">$</span>facesXboxes<span class="op">$</span>iface[<span class="kw"><a href="https://rdrr.io/r/base/which.html">which</a></span>(bgm<span class="op">$</span>facesXboxes<span class="op">$</span>.bx0 <span class="op">%in%</span><span class="st"> </span>boxes<span class="op">$</span>.bx0)], allfaces<span class="op">$</span>.fx0), ]</span></code></pre></div>
<p>Plot the two layers together.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(boxes, <span class="dt">main =</span> <span class="st">"boxes only"</span>)</span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="kw"><a href="https://rdrr.io/r/graphics/text.html">text</a></span>(<span class="kw">coordinates</span>(boxes), <span class="dt">lab =</span> <span class="kw"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(<span class="st">"%s</span><span class="ch">\n</span><span class="st">nconn: %s"</span>, boxes<span class="op">$</span>label, boxes<span class="op">$</span>nconn))</span></code></pre></div>
<p><img src="BGMfiles_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(boxes, <span class="dt">main =</span> <span class="st">"boxes and faces overlaid"</span>)</span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="kw"><a href="https://rdrr.io/r/graphics/text.html">text</a></span>(<span class="kw">coordinates</span>(boxes), <span class="dt">lab =</span> <span class="kw"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(<span class="st">"%s</span><span class="ch">\n</span><span class="st">nconn: %s"</span>, boxes<span class="op">$</span>label, boxes<span class="op">$</span>nconn))</span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(faces, <span class="dt">col =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"firebrick"</span>), <span class="dt">lwd =</span> <span class="dv">1</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="BGMfiles_files/figure-html/unnamed-chunk-7-2.png" width="700"></p>
<p>(Future releases will provide simpler tools to do this kind of matching).</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#box-geometry-model-files">Box Geometry Model files</a></li>
      <li><a href="#box-and-face-attributes-and-model-topology">Box and face attributes, and model topology</a></li>
      <li><a href="#convert-to-spatial-objects">Convert to Spatial objects</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Michael D. Sumner.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
